<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Narrative Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.4;
            overflow: hidden;
        }

        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #111111;
            padding: 10px 20px;
            border-bottom: 2px solid #ff00ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .title {
            color: #ff00ff;
            font-weight: bold;
            font-size: 16px;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .control-group label {
            color: #ffffff;
            font-size: 12px;
        }

        select {
            background-color: #222222;
            color: #ffffff;
            border: 1px solid #ff00ff;
            padding: 4px 8px;
            font-size: 12px;
            font-family: inherit;
        }

        select:focus {
            outline: none;
            border-color: #ffffff;
        }

        .progress {
            color: #ff00ff;
            font-size: 12px;
        }

        .main-content {
            flex: 1;
            display: flex;
            min-height: 0;
        }

        .display-area {
            flex: 1;
            background-color: #111111;
            margin: 20px;
            border: 2px solid #ff00ff;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .weather-display {
            width: 400px;
            height: 300px;
            background-color: #ffffff;
            border: 1px solid #cccccc;
            position: relative;
            overflow: hidden;
        }

        .weather-display img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .no-image {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000000;
            font-family: Arial, sans-serif;
            font-size: 14px;
            padding: 20px;
            text-align: center;
        }

        .metadata {
            width: 350px;
            background-color: #111111;
            margin: 20px 0 20px 0;
            border: 2px solid #ff00ff;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }

        .metadata.visible {
            display: block;
        }

        .metadata h3 {
            color: #ff00ff;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .metadata-row {
            margin-bottom: 8px;
            font-size: 12px;
        }

        .metadata-label {
            color: #ff00ff;
            display: inline-block;
            width: 120px;
        }

        .metadata-value {
            color: #ffffff;
        }

        .narrative-text {
            background-color: #222222;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #ff00ff;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .status-bar {
            background-color: #111111;
            padding: 8px 20px;
            border-top: 1px solid #ff00ff;
            font-size: 12px;
            color: #ff00ff;
            flex-shrink: 0;
        }

        .help-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .help-content {
            background-color: #111111;
            border: 2px solid #ff00ff;
            padding: 30px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .help-content h3 {
            color: #ff00ff;
            margin-bottom: 15px;
        }

        .help-content ul {
            list-style: none;
            padding: 0;
        }

        .help-content li {
            margin-bottom: 8px;
            padding-left: 15px;
        }

        .help-content .key {
            color: #ff00ff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">Weather Narrative Viewer</div>
            <div class="controls">
                <div class="control-group">
                    <label for="date-select">Jump to:</label>
                    <select id="date-select">
                        <option value="">Select date...</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="overflow-filter">Overflow:</label>
                    <select id="overflow-filter">
                        <option value="all">All</option>
                        <option value="overflow">Only Overflow</option>
                        <option value="fits">Only Fits</option>
                    </select>
                </div>
                <div class="progress" id="progress">0 / 0</div>
            </div>
        </div>

        <div class="main-content">
            <div class="display-area">
                <div class="weather-display" id="weather-display">
                    Loading...
                </div>
            </div>
            <div class="metadata" id="metadata">
                <h3>Metadata (M to toggle)</h3>
                <div id="metadata-content"></div>
            </div>
        </div>

        <div class="status-bar">
            Press H for help | Arrow keys to navigate | M to toggle metadata
        </div>

        <div class="help-overlay" id="help-overlay">
            <div class="help-content">
                <h3>Keyboard Controls</h3>
                <ul>
                    <li><span class="key">←/→</span> Previous/Next hour</li>
                    <li><span class="key">Page Up/Down</span> Jump 24 hours</li>
                    <li><span class="key">Home/End</span> First/Last record</li>
                    <li><span class="key">M</span> Toggle metadata panel</li>
                    <li><span class="key">H</span> Toggle this help</li>
                    <li><span class="key">Esc</span> Close help</li>
                </ul>
                <p style="margin-top: 15px; color: #ffffff; font-size: 12px;">
                    Use dropdown controls to jump to specific dates or filter by overflow status.
                </p>
            </div>
        </div>
    </div>

    <script>
        // DATA_PLACEHOLDER - will be replaced with actual data
        const narrativeData = [
  {
    "timestamp": "1704067200",
    "date": "2023-12-31",
    "hour": "19:00",
    "narrative_text": "Overcast and cold. 4.5\u00b0C. feels like 0.8\u00b0C with wind chill.",
    "text_length_px": "256",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "4.5",
    "weather_desc": "overcast",
    "char_count": "59",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704070800",
    "date": "2023-12-31",
    "hour": "20:00",
    "narrative_text": "Mainly clear and cold. 3.5\u00b0C. feels like -0.2\u00b0C with wind chill.",
    "text_length_px": "278",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.5",
    "weather_desc": "mainly clear",
    "char_count": "64",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704074400",
    "date": "2023-12-31",
    "hour": "21:00",
    "narrative_text": "Overcast and cold. 3.9\u00b0C. feels like 0.3\u00b0C with wind chill.",
    "text_length_px": "256",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.9",
    "weather_desc": "overcast",
    "char_count": "59",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704078000",
    "date": "2023-12-31",
    "hour": "22:00",
    "narrative_text": "Partly cloudy and cold. 4.0\u00b0C. feels like -0.3\u00b0C with wind chill. breezy.",
    "text_length_px": "318",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "4.0",
    "weather_desc": "partly cloudy",
    "char_count": "73",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704081600",
    "date": "2023-12-31",
    "hour": "23:00",
    "narrative_text": "Partly cloudy and cold. 3.2\u00b0C. feels like -0.4\u00b0C with wind chill.",
    "text_length_px": "281",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.2",
    "weather_desc": "partly cloudy",
    "char_count": "65",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704085200",
    "date": "2024-01-01",
    "hour": "00:00",
    "narrative_text": "Overcast and cold. 3.3\u00b0C. feels like -0.7\u00b0C with wind chill. breezy.",
    "text_length_px": "296",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.3",
    "weather_desc": "overcast",
    "char_count": "68",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704088800",
    "date": "2024-01-01",
    "hour": "01:00",
    "narrative_text": "Overcast and cold. 3.5\u00b0C. feels like -0.5\u00b0C with wind chill. breezy.",
    "text_length_px": "296",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.5",
    "weather_desc": "overcast",
    "char_count": "68",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704092400",
    "date": "2024-01-01",
    "hour": "02:00",
    "narrative_text": "Overcast and cold. 3.7\u00b0C. feels like 0.2\u00b0C with wind chill.",
    "text_length_px": "256",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.7",
    "weather_desc": "overcast",
    "char_count": "59",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704096000",
    "date": "2024-01-01",
    "hour": "03:00",
    "narrative_text": "Mainly clear and cold. 4.1\u00b0C. feels like 1.0\u00b0C with wind chill.",
    "text_length_px": "275",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "4.1",
    "weather_desc": "mainly clear",
    "char_count": "63",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704099600",
    "date": "2024-01-01",
    "hour": "04:00",
    "narrative_text": "Clear sky and cold. 3.2\u00b0C. feels like 0.3\u00b0C with wind chill.",
    "text_length_px": "261",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.2",
    "weather_desc": "clear sky",
    "char_count": "60",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704103200",
    "date": "2024-01-01",
    "hour": "05:00",
    "narrative_text": "Overcast and cold. 3.5\u00b0C. feels like 0.4\u00b0C with wind chill.",
    "text_length_px": "256",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.5",
    "weather_desc": "overcast",
    "char_count": "59",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704106800",
    "date": "2024-01-01",
    "hour": "06:00",
    "narrative_text": "Overcast and cold. 3.2\u00b0C. feels like -0.2\u00b0C with wind chill.",
    "text_length_px": "259",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.2",
    "weather_desc": "overcast",
    "char_count": "60",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704110400",
    "date": "2024-01-01",
    "hour": "07:00",
    "narrative_text": "Overcast and cold. 3.2\u00b0C. feels like 0.2\u00b0C with wind chill.",
    "text_length_px": "256",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.2",
    "weather_desc": "overcast",
    "char_count": "59",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704114000",
    "date": "2024-01-01",
    "hour": "08:00",
    "narrative_text": "Overcast and cold. 3.3\u00b0C. feels like 0.7\u00b0C with wind chill. very humid.",
    "text_length_px": "315",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.3",
    "weather_desc": "overcast",
    "char_count": "71",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704117600",
    "date": "2024-01-01",
    "hour": "09:00",
    "narrative_text": "Light drizzle and cold. 3.7\u00b0C. feels like 1.5\u00b0C with wind chill. very humid.",
    "text_length_px": "337",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.7",
    "weather_desc": "light drizzle",
    "char_count": "76",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704121200",
    "date": "2024-01-01",
    "hour": "10:00",
    "narrative_text": "Partly cloudy and cold. 4.8\u00b0C. feels like 2.1\u00b0C with wind chill. very humid.",
    "text_length_px": "337",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "4.8",
    "weather_desc": "partly cloudy",
    "char_count": "76",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704124800",
    "date": "2024-01-01",
    "hour": "11:00",
    "narrative_text": "Clear sky and cold. 5.9\u00b0C. feels like 3.5\u00b0C with wind chill.",
    "text_length_px": "261",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "5.9",
    "weather_desc": "clear sky",
    "char_count": "60",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704128400",
    "date": "2024-01-01",
    "hour": "12:00",
    "narrative_text": "Clear sky and cold. 6.4\u00b0C. feels like 4.3\u00b0C with wind chill.",
    "text_length_px": "261",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "6.4",
    "weather_desc": "clear sky",
    "char_count": "60",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704132000",
    "date": "2024-01-01",
    "hour": "13:00",
    "narrative_text": "Mainly clear and cold. 7.2\u00b0C. feels like 4.6\u00b0C with wind chill.",
    "text_length_px": "275",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "7.2",
    "weather_desc": "mainly clear",
    "char_count": "63",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704135600",
    "date": "2024-01-01",
    "hour": "14:00",
    "narrative_text": "Mainly clear and cold. 7.4\u00b0C. feels like 4.9\u00b0C with wind chill.",
    "text_length_px": "275",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "7.4",
    "weather_desc": "mainly clear",
    "char_count": "63",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704139200",
    "date": "2024-01-01",
    "hour": "15:00",
    "narrative_text": "Overcast and cold. 6.9\u00b0C. feels like 4.5\u00b0C with wind chill.",
    "text_length_px": "256",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "6.9",
    "weather_desc": "overcast",
    "char_count": "59",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704142800",
    "date": "2024-01-01",
    "hour": "16:00",
    "narrative_text": "Overcast and cold. 6.4\u00b0C. feels like 4.2\u00b0C with wind chill.",
    "text_length_px": "256",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "6.4",
    "weather_desc": "overcast",
    "char_count": "59",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704146400",
    "date": "2024-01-01",
    "hour": "17:00",
    "narrative_text": "Overcast and cold. 5.2\u00b0C. feels like 2.5\u00b0C with wind chill.",
    "text_length_px": "256",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "5.2",
    "weather_desc": "overcast",
    "char_count": "59",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704150000",
    "date": "2024-01-01",
    "hour": "18:00",
    "narrative_text": "Mainly clear and cold. 4.9\u00b0C. feels like 1.3\u00b0C with wind chill.",
    "text_length_px": "275",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "4.9",
    "weather_desc": "mainly clear",
    "char_count": "63",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704153600",
    "date": "2024-01-01",
    "hour": "19:00",
    "narrative_text": "Partly cloudy and cold. 3.8\u00b0C. feels like 0.4\u00b0C with wind chill.",
    "text_length_px": "278",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.8",
    "weather_desc": "partly cloudy",
    "char_count": "64",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704157200",
    "date": "2024-01-01",
    "hour": "20:00",
    "narrative_text": "Overcast and cold. 3.2\u00b0C. feels like -1.1\u00b0C with wind chill. breezy.",
    "text_length_px": "296",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.2",
    "weather_desc": "overcast",
    "char_count": "68",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704160800",
    "date": "2024-01-01",
    "hour": "21:00",
    "narrative_text": "Clear sky and cold. 2.5\u00b0C. feels like -1.2\u00b0C with wind chill.",
    "text_length_px": "264",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "2.5",
    "weather_desc": "clear sky",
    "char_count": "61",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704164400",
    "date": "2024-01-01",
    "hour": "22:00",
    "narrative_text": "Clear sky and cold. 2.0\u00b0C. feels like -1.9\u00b0C with wind chill.",
    "text_length_px": "264",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "2.0",
    "weather_desc": "clear sky",
    "char_count": "61",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704168000",
    "date": "2024-01-01",
    "hour": "23:00",
    "narrative_text": "Overcast and cold. 1.5\u00b0C. feels like -2.6\u00b0C with wind chill. breezy.",
    "text_length_px": "296",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "1.5",
    "weather_desc": "overcast",
    "char_count": "68",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704171600",
    "date": "2024-01-02",
    "hour": "00:00",
    "narrative_text": "Mainly clear and cold. 0.7\u00b0C. feels like -3.1\u00b0C with wind chill.",
    "text_length_px": "278",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "0.7",
    "weather_desc": "mainly clear",
    "char_count": "64",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704175200",
    "date": "2024-01-02",
    "hour": "01:00",
    "narrative_text": "Mainly clear and freezing. -0.1\u00b0C. feels like -4.0\u00b0C with wind chill.",
    "text_length_px": "303",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "-0.1",
    "weather_desc": "mainly clear",
    "char_count": "69",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704178800",
    "date": "2024-01-02",
    "hour": "02:00",
    "narrative_text": "Clear sky and freezing. -0.6\u00b0C. feels like -4.8\u00b0C with wind chill. breezy.",
    "text_length_px": "326",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "-0.6",
    "weather_desc": "clear sky",
    "char_count": "74",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704182400",
    "date": "2024-01-02",
    "hour": "03:00",
    "narrative_text": "Clear sky and freezing. -0.8\u00b0C. feels like -4.8\u00b0C with wind chill.",
    "text_length_px": "289",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "-0.8",
    "weather_desc": "clear sky",
    "char_count": "66",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704186000",
    "date": "2024-01-02",
    "hour": "04:00",
    "narrative_text": "Clear sky and freezing. -1.0\u00b0C. feels like -5.8\u00b0C with wind chill. breezy.",
    "text_length_px": "326",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "-1.0",
    "weather_desc": "clear sky",
    "char_count": "74",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704189600",
    "date": "2024-01-02",
    "hour": "05:00",
    "narrative_text": "Clear sky and freezing. -1.2\u00b0C. feels like -5.7\u00b0C with wind chill. breezy.",
    "text_length_px": "326",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "-1.2",
    "weather_desc": "clear sky",
    "char_count": "74",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704193200",
    "date": "2024-01-02",
    "hour": "06:00",
    "narrative_text": "Clear sky and freezing. -1.6\u00b0C. feels like -6.1\u00b0C with wind chill. breezy.",
    "text_length_px": "326",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "-1.6",
    "weather_desc": "clear sky",
    "char_count": "74",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704196800",
    "date": "2024-01-02",
    "hour": "07:00",
    "narrative_text": "Overcast and freezing. -1.6\u00b0C. feels like -6.2\u00b0C with wind chill. breezy.",
    "text_length_px": "321",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "-1.6",
    "weather_desc": "overcast",
    "char_count": "73",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704200400",
    "date": "2024-01-02",
    "hour": "08:00",
    "narrative_text": "Clear sky and freezing. -1.6\u00b0C. feels like -5.8\u00b0C with wind chill.",
    "text_length_px": "289",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "-1.6",
    "weather_desc": "clear sky",
    "char_count": "66",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704204000",
    "date": "2024-01-02",
    "hour": "09:00",
    "narrative_text": "Clear sky and freezing. -0.9\u00b0C. feels like -5.3\u00b0C with wind chill. breezy.",
    "text_length_px": "326",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "-0.9",
    "weather_desc": "clear sky",
    "char_count": "74",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704207600",
    "date": "2024-01-02",
    "hour": "10:00",
    "narrative_text": "Clear sky and cold. 0.4\u00b0C. feels like -4.3\u00b0C with wind chill. breezy.",
    "text_length_px": "301",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "0.4",
    "weather_desc": "clear sky",
    "char_count": "69",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704211200",
    "date": "2024-01-02",
    "hour": "11:00",
    "narrative_text": "Clear sky and cold. 1.7\u00b0C. feels like -2.9\u00b0C with wind chill. breezy.",
    "text_length_px": "301",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "1.7",
    "weather_desc": "clear sky",
    "char_count": "69",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704214800",
    "date": "2024-01-02",
    "hour": "12:00",
    "narrative_text": "Clear sky and cold. 2.8\u00b0C. feels like -1.7\u00b0C with wind chill. breezy.",
    "text_length_px": "301",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "2.8",
    "weather_desc": "clear sky",
    "char_count": "69",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704218400",
    "date": "2024-01-02",
    "hour": "13:00",
    "narrative_text": "Clear sky and cold. 4.2\u00b0C. feels like -0.5\u00b0C with wind chill. breezy.",
    "text_length_px": "301",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "4.2",
    "weather_desc": "clear sky",
    "char_count": "69",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704222000",
    "date": "2024-01-02",
    "hour": "14:00",
    "narrative_text": "Clear sky and cold. 5.1\u00b0C. feels like 0.7\u00b0C with wind chill. breezy.",
    "text_length_px": "298",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "5.1",
    "weather_desc": "clear sky",
    "char_count": "68",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704225600",
    "date": "2024-01-02",
    "hour": "15:00",
    "narrative_text": "Clear sky and cold. 5.6\u00b0C. feels like 1.4\u00b0C with wind chill. breezy.",
    "text_length_px": "298",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "5.6",
    "weather_desc": "clear sky",
    "char_count": "68",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704229200",
    "date": "2024-01-02",
    "hour": "16:00",
    "narrative_text": "Clear sky and cold. 5.2\u00b0C. feels like 0.8\u00b0C with wind chill. breezy.",
    "text_length_px": "298",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "5.2",
    "weather_desc": "clear sky",
    "char_count": "68",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704232800",
    "date": "2024-01-02",
    "hour": "17:00",
    "narrative_text": "Clear sky and cold. 3.5\u00b0C. feels like -0.2\u00b0C with wind chill.",
    "text_length_px": "264",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.5",
    "weather_desc": "clear sky",
    "char_count": "61",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704236400",
    "date": "2024-01-02",
    "hour": "18:00",
    "narrative_text": "Clear sky and cold. 3.0\u00b0C. feels like -0.2\u00b0C with wind chill.",
    "text_length_px": "264",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "3.0",
    "weather_desc": "clear sky",
    "char_count": "61",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704240000",
    "date": "2024-01-02",
    "hour": "19:00",
    "narrative_text": "Clear sky and cold. 2.5\u00b0C. feels like -1.1\u00b0C with wind chill.",
    "text_length_px": "264",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "2.5",
    "weather_desc": "clear sky",
    "char_count": "61",
    "overflow_lines": "0"
  },
  {
    "timestamp": "1704243600",
    "date": "2024-01-02",
    "hour": "20:00",
    "narrative_text": "Clear sky and cold. 2.2\u00b0C. feels like -1.9\u00b0C with wind chill.",
    "text_length_px": "264",
    "text_height_px": "12",
    "line_count": "1",
    "fits_display": "True",
    "temp": "2.2",
    "weather_desc": "clear sky",
    "char_count": "61",
    "overflow_lines": "0"
  }
];
        let filteredData = [];
        let currentIndex = 0;

        function populateDateSelect() {
            const select = document.getElementById('date-select');
            const dates = [...new Set(narrativeData.map(record => record.date))].sort();

            select.innerHTML = '<option value="">Select date...</option>';
            dates.forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = date;
                select.appendChild(option);
            });
        }

        function updateDisplay() {
            if (filteredData.length === 0) return;

            const record = filteredData[currentIndex];
            const display = document.getElementById('weather-display');
            const imagePath = `images/${record.date.replace(/-/g, '-')}-${record.hour.replace(':', '-')}.png`;

            // Update the date select to show current date
            const dateSelect = document.getElementById('date-select');
            dateSelect.value = record.date;

            // Try to load the actual image
            const img = new Image();
            img.onload = function() {
                display.innerHTML = `<img src="${imagePath}" alt="Weather display for ${record.date} ${record.hour}">`;
            };
            img.onerror = function() {
                display.innerHTML = `
                    <div class="no-image">
                        <div>
                            <strong>${record.date} ${record.hour}</strong><br>
                            ${record.weather_desc}<br>
                            ${record.temp}°C<br>
                            <br>
                            Image not found: ${imagePath}
                        </div>
                    </div>
                `;
            };
            img.src = imagePath;

            updateMetadata(record);
        }

        function updateMetadata(record) {
            const content = document.getElementById('metadata-content');
            content.innerHTML = `
                <div class="metadata-row">
                    <span class="metadata-label">Timestamp:</span>
                    <span class="metadata-value">${record.timestamp}</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Date:</span>
                    <span class="metadata-value">${record.date}</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Hour:</span>
                    <span class="metadata-value">${record.hour}</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Temperature:</span>
                    <span class="metadata-value">${record.temp}°C</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Weather:</span>
                    <span class="metadata-value">${record.weather_desc}</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Text Width:</span>
                    <span class="metadata-value">${record.text_length_px}px</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Text Height:</span>
                    <span class="metadata-value">${record.text_height_px}px</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Line Count:</span>
                    <span class="metadata-value">${record.line_count}</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Fits Display:</span>
                    <span class="metadata-value">${record.fits_display}</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Characters:</span>
                    <span class="metadata-value">${record.char_count}</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Overflow Lines:</span>
                    <span class="metadata-value">${record.overflow_lines}</span>
                </div>
                <div class="narrative-text">${record.narrative_text}</div>
            `;
        }

        function updateProgress() {
            document.getElementById('progress').textContent = `${currentIndex + 1} / ${filteredData.length}`;
        }

        function navigate(direction) {
            const oldIndex = currentIndex;

            if (direction === 'next') {
                currentIndex = Math.min(currentIndex + 1, filteredData.length - 1);
            } else if (direction === 'prev') {
                currentIndex = Math.max(currentIndex - 1, 0);
            } else if (direction === 'pageup') {
                currentIndex = Math.max(currentIndex - 24, 0);
            } else if (direction === 'pagedown') {
                currentIndex = Math.min(currentIndex + 24, filteredData.length - 1);
            } else if (direction === 'home') {
                currentIndex = 0;
            } else if (direction === 'end') {
                currentIndex = filteredData.length - 1;
            }

            if (currentIndex !== oldIndex) {
                updateDisplay();
                updateProgress();
            }
        }

        function filterData() {
            const filterValue = document.getElementById('overflow-filter').value;

            if (filterValue === 'all') {
                filteredData = narrativeData.slice();
            } else if (filterValue === 'overflow') {
                filteredData = narrativeData.filter(record => record.fits_display === 'False');
            } else if (filterValue === 'fits') {
                filteredData = narrativeData.filter(record => record.fits_display === 'True');
            }

            currentIndex = 0;
            updateDisplay();
            updateProgress();
        }

        function jumpToDate() {
            const selectedDate = document.getElementById('date-select').value;
            if (!selectedDate) return;

            const index = filteredData.findIndex(record => record.date === selectedDate);
            if (index >= 0) {
                currentIndex = index;
                updateDisplay();
                updateProgress();
            }
        }

        function toggleMetadata() {
            const metadata = document.getElementById('metadata');
            metadata.classList.toggle('visible');
        }

        function toggleHelp() {
            const help = document.getElementById('help-overlay');
            const isVisible = help.style.display === 'flex';
            help.style.display = isVisible ? 'none' : 'flex';
        }

        // Event listeners
        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowRight':
                    navigate('next');
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    navigate('prev');
                    e.preventDefault();
                    break;
                case 'PageUp':
                    navigate('pageup');
                    e.preventDefault();
                    break;
                case 'PageDown':
                    navigate('pagedown');
                    e.preventDefault();
                    break;
                case 'Home':
                    navigate('home');
                    e.preventDefault();
                    break;
                case 'End':
                    navigate('end');
                    e.preventDefault();
                    break;
                case 'm':
                case 'M':
                    toggleMetadata();
                    break;
                case 'h':
                case 'H':
                    toggleHelp();
                    break;
                case 'Escape':
                    document.getElementById('help-overlay').style.display = 'none';
                    break;
            }
        });

        document.getElementById('overflow-filter').addEventListener('change', filterData);
        document.getElementById('date-select').addEventListener('change', jumpToDate);
        document.getElementById('help-overlay').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                toggleHelp();
            }
        });

        // Initialize
        function init() {
            if (narrativeData.length === 0) {
                document.getElementById('weather-display').innerHTML = '<div class="no-image">No data loaded</div>';
                return;
            }

            filteredData = narrativeData.slice();
            populateDateSelect();
            updateDisplay();
            updateProgress();
        }

        // Start when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
